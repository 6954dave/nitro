<?xml version="1.0" encoding="utf-8"?>
<project name="nitf" basedir="." default="build">

    <target name="init">
        <property name="object-dir" location="target/classes"/>
        <property name="lib-dir" location="target"/>

        <mkdir dir="${object-dir}"/>
        <mkdir dir="${lib-dir}"/>
        <loadproperties srcFile="project.properties"/>

        <!-- some defaults here -->
        <property name="jni.dir" location="../../c/nitf.jni/"/>
        <property name="jni.gnu" value=""/>
        <property name="jni.debug" value=""/>
        <property name="prefix" value="${lib-dir}/nitro-java-${version}"/>
        <property name="notWindows" value="true"/>
        <condition property="notWindows" value="false">
            <os family="windows"/>
        </condition>
    </target>


    <target name="clean" depends="init">
        <echo>"====================================================="</echo>
        <echo>"                        CLEAN                        "</echo>
        <echo>"====================================================="</echo>
        <delete dir="${object-dir}"/>
        <delete dir="${lib-dir}"/>
        <delete dir="${javadoc-dir}"/>
        <delete dir="${javadoc-dir}"/>
    </target>


    <target name="compile" depends="init">
        <echo>"====================================================="</echo>
        <echo>"                       COMPILE                       "</echo>
        <echo>"====================================================="</echo>
        <javac srcdir="${src.dir}" destdir="${object-dir}"
            failonerror="yes" fork="true"/>
    </target>


    <target name="build" depends="compile">
        <echo>"====================================================="</echo>
        <echo>"                        BUILD                        "</echo>
        <echo>"====================================================="</echo>
        <jar basedir="${object-dir}" destfile="${lib-dir}/${projectName}-${version}.jar"/>
    </target>


    <target name="tests" depends="build">
        <echo>"====================================================="</echo>
        <echo>"                        TESTS                        "</echo>
        <echo>"====================================================="</echo>
        <javac srcdir="${test.dir}"
            destdir="${object-dir}"
            classpath="${object-dir}"
            failonerror="yes" fork="true"/>
    </target>


    <target name="javadoc" depends="init">
        <echo>"====================================================="</echo>
        <echo>"                       JAVADOC                       "</echo>
        <echo>"====================================================="</echo>
        <!--get the current timestamp-->
        <tstamp>
            <format property="touch.time" pattern="MM/dd/yyyy hh:mm:ss aa"/>
        </tstamp>

        <javadoc packagenames="nitf.*"
            sourcepath="${src.dir}"
            defaultexcludes="yes"
            destdir="${javadoc.dir}"
            author="true"
            version="true"
            use="true"
            windowtitle="NITF API">

            <bottom><![CDATA[<i>Copyright &#169; 2004-2008 General Dynamics All Rights Reserved.</i>]]></bottom>
            <footer><![CDATA[<b>Created: ${touch.time}</b>]]></footer>
            <tag name="todo" scope="all" description="To do:"/>
        </javadoc>
    </target>


    <target name="jni" depends="init" if="notWindows">
        <condition property="jni.debug" value="--enable-debugging">
            <istrue value="${debug}"/>
        </condition>

        <condition property="jni.gnu" value="--enable-gnu">
            <istrue value="${gnu}"/>
        </condition>

        <exec dir="${jni.dir}" executable="sh">
            <arg line="configure --prefix=${prefix} ${jni.debug} ${jni.gnu}"/>
        </exec>
        <exec dir="${jni.dir}" executable="make"/>
        <exec dir="${jni.dir}" executable="make">
            <arg line="install"/>
        </exec>
    </target>


    <target name="install" depends="jni,build" if="notWindows">
        <copy todir="${prefix}">
            <fileset dir="${lib-dir}" includes="${projectName}-${version}.jar"/>
        </copy>
        <copy todir="${prefix}/tests">
            <fileset dir="${test.dir}" includes="Test*.java"/>
        </copy>
    </target>

    <target name="dist" depends="install" if="notWindows">
        <basename property="installdir" file="${prefix}"/>
        <tar tarfile="${lib-dir}/${installdir}.tar" basedir="${prefix}"/>
        <gzip zipfile="${lib-dir}/${installdir}.tar.gz" src="${lib-dir}/${installdir}.tar"/>
    </target>


</project>
